<head>
   <title>T or N</title>
   <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
   <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
   <style>
   body {color:black; font-size:14pt; font-family:"Open Sans", sans-serif; background-color:white; white-space: nowrap;}
   p.prediction {
     margin-right:50%;
     margin-left: 25%;
     }
   p.route {
    font-size: 120pt;
     margin-top:10%;
     margin-left: 25%;
   }
   </style>
</head>


<!DOCTYPE html>
<meta charset="UTF-8">
<html>
<body>
  <p>
    <script>

      var nextMuni = null;
      var nextT = null;
      var nextN = null;

      function fetchPredictions(url, muniLine){
       

        d3.xml(url, function(xml) {
          var minutes =  d3.select(xml).selectAll("prediction")[0].map(function(prediction){
            return d3.select(prediction).attr("minutes");
            });
            if (minutes.length===0){
              d3.select(muniLine).text("--")
            }
            else{ 
              d3.select(muniLine).text(minutes);
            }

            if (muniLine === "#T-Third"){
              nextT = minutes[0];
              console.log("next" + muniLine + ": " + nextT);
            } else if (muniLine === "#N-Judah"){
              nextN = minutes[0];
              console.log("next" + muniLine + ": " + nextN);
            }

            if (this.nextT < this.nextN){
              d3.select("#nextMuni").text("T");
            } else if (this.nextN < this.nextT){
              d3.select("#nextMuni").text("N");
            } else if (this.nextT === this.nextN) {
              d3.select("#nextMuni").text("¯\\\_(ツ)_/¯");
            }

          });
      } 

      function refreshPredictions(){
    
        // K-Ingleside T-Third Street
        fetchPredictions("http://webservices.nextbus.com/service/publicXMLFeed?command=predictions&a=sf-muni&stopId=17166&routeTag=KT", "#T-Third"); 

        // N-Judah
        fetchPredictions("http://webservices.nextbus.com/service/publicXMLFeed?command=predictions&a=sf-muni&stopId=15240&routeTag=N", "#N-Judah");

        
      }

      refreshPredictions();
      window.setInterval(refreshPredictions,15000);
    </script>
  </p>
  <div id="predictions">
    <p class="route"><span style="color:black;font-weight:bold"></span><span id="nextMuni"></span id>
    <p class = "prediction"><span style="color:000000;font-weight:bold">Next T departures: </span><span id="T-Third"></span id></p>
    <p class = "prediction"><span style="color:000000;font-weight:bold">Next N departures: </span><span id="N-Judah"></span id></p>
  </div>
</body>
</html>
